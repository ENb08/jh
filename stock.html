<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Gestion Stock & Dépôts — SuperMarket Pro</title>
    <meta name="description" content="Gestion complète du stock, dépôts, mouvements et alertes - SuperMarket Pro">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="assets/css/style_stock.css" />
    <link rel="icon" href="assets/img/favicon.ico" type="image/x-icon" />
</head>

<body>
    <div class="app">
        <aside class="sidebar" aria-label="Navigation principale">
            <div class="brand">
                <div class="logo">JH</div>
                <div>
                    <div style="font-weight:700">Jeremie Humble</div>
                    <div style="font-size:12px;color:var(--muted)">Stock & Dépôts</div>
                </div>
            </div>

            <nav>
                <a href="acceuil.html" class="menu-item"><i class="fas fa-home"></i> Tableau de Bord</a>
                <a href="#" class="menu-item"><i class="fas fa-cash-register"></i> Vente / Caisse</a>
                <a href="stock.html" class="menu-item active"><i class="fas fa-box"></i> Gestion Stock</a>
            </nav>

            <div class="small">© <span id="year"></span> </div>
        </aside>

        <main class="main" role="main">
            <div class="topbar">
                <h1><i class="fas fa-warehouse"></i> Gestion du Stock & Dépôts</h1>
                <div class="controls">
                    <button class="btn success" id="btn-new-product"><i class="fas fa-plus"></i> Nouveau
                        produit</button>
                    <button class="btn" id="btn-add-stock"><i class="fas fa-arrow-up"></i> Entrée stock</button>
                    <button class="btn warning" id="btn-inventory"><i class="fas fa-sync"></i> Inventaire</button>
                    <button class="btn secondary" id="btn-export"><i class="fas fa-file-export"></i> Export</button>
                </div>
            </div>

            <!-- STATS -->
            <div class="stats">
                <div class="stat-card" style="border-left-color:var(--accent)">
                    <h4>Total Produits</h4>
                    <div class="value" id="stat-total">0</div>
                </div>
                <div class="stat-card" style="border-left-color:var(--accent-2)">
                    <h4>Valeur Stock</h4>
                    <div class="value" id="stat-value">0.00 €</div>
                </div>
                <div class="stat-card" style="border-left-color:var(--warning)">
                    <h4>Stock Bas</h4>
                    <div class="value" id="stat-low">0</div>
                </div>
                <div class="stat-card" style="border-left-color:var(--danger)">
                    <h4>Ruptures</h4>
                    <div class="value" id="stat-critical">0</div>
                </div>
            </div>

            <!-- TABS -->
            <div class="tabs" role="tablist">
                <button class="tab active" data-tab="products"><i class="fas fa-list"></i> Catalogue</button>
                <button class="tab" data-tab="movements"><i class="fas fa-arrows-alt"></i> Mouvements</button>
                <button class="tab" data-tab="magasin"><i class="fas fa-store"></i> Magasin 1</button>
                <button class="tab" data-tab="alerts"><i class="fas fa-bell"></i> Alertes</button>
                <button class="tab" data-tab="history"><i class="fas fa-history"></i> Historique</button>
            </div>

            <!-- TAB: PRODUCTS -->
            <section id="tab-products" class="panel" role="tabpanel" aria-labelledby="tab-products">
                <div class="filters">
                    <input id="search" class="input" type="search"
                        placeholder="Rechercher produit, ref, catégorie..." />
                    <select id="filter-state" class="input" style="width:140px">
                        <option value="">Tous les États</option>
                        <option value="ok">En stock</option>
                        <option value="low">Stock Bas</option>
                        <option value="critical">Rupture</option>
                    </select>
                </div>

                <table aria-label="Catalogue produits">
                    <thead>
                        <tr>
                            <th>Réf / Code</th>
                            <th>Désignation</th>
                            <th>Catégorie</th>
                            <th>Prix A.</th>
                            <th>Prix V.</th>
                            <th style="text-align:center">Stock</th>
                            <th>État</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="productsTable"></tbody>
                </table>
            </section>

            <!-- TAB: MOVEMENTS -->
            <section id="tab-movements" class="panel" role="tabpanel" aria-labelledby="tab-movements"
                style="display:none">
                <div class="panel-head">
                    <h3>Mouvements de Stock</h3>
                    <button class="btn" id="btn-new-movement"><i class="fas fa-plus"></i> Nouveau</button>
                </div>

                <table aria-label="Mouvements de stock">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Type</th>
                            <th>Produit</th>
                            <th>Quantité</th>
                            <th>De / Vers</th>
                            <th>Ref Mouvement</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody id="movementsTable"></tbody>
                </table>
            </section>

            <!-- TAB: MAGASIN 1 -->
            <section id="tab-magasin" class="panel" role="tabpanel" aria-labelledby="tab-magasin" style="display:none">
                <div class="panel-head">
                    <h3><i class="fas fa-store"></i> Magasin 1 - Inventaire</h3>
                    <button class="btn success" id="btn-appro-magasin"><i class="fas fa-truck"></i> Approvisionner</button>
                </div>

                <!-- Statistiques du magasin -->
                <div class="stats" style="margin-bottom:20px;">
                    <div class="stat-card" style="border-left-color:var(--accent)">
                        <h4>Total Produits</h4>
                        <div class="value" id="mag-total-products">0</div>
                    </div>
                    <div class="stat-card" style="border-left-color:var(--warning)">
                        <h4>Total Articles</h4>
                        <div class="value" id="mag-total-items">0</div>
                    </div>
                    <div class="stat-card" style="border-left-color:var(--accent-2)">
                        <h4>Valeur CDF</h4>
                        <div class="value" id="mag-value-cdf">0 FC</div>
                    </div>
                    <div class="stat-card" style="border-left-color:var(--success)">
                        <h4>Valeur USD</h4>
                        <div class="value" id="mag-value-usd">$0.00</div>
                    </div>
                </div>

                <table aria-label="Stock Magasin 1">
                    <thead>
                        <tr>
                            <th>Réf / Code</th>
                            <th>Produit</th>
                            <th>Catégorie</th>
                            <th>Prix Unitaire (CDF)</th>
                            <th>Prix Unitaire (USD)</th>
                            <th style="text-align:center">Quantité</th>
                            <th>Valeur CDF</th>
                            <th>Valeur USD</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="magasinTable"></tbody>
                </table>
            </section>

            <!-- TAB: ALERTS -->
            <section id="tab-alerts" class="panel" role="tabpanel" aria-labelledby="tab-alerts" style="display:none">
                <h3>Alertes & Notifications</h3>

                <div id="alertsList" style="display:flex;flex-direction:column;gap:10px"></div>
            </section>

            <!-- TAB: HISTORY -->
            <section id="tab-history" class="panel" role="tabpanel" aria-labelledby="tab-history" style="display:none">
                <div class="filters">
                    <input id="history-search" class="input" type="search" placeholder="Rechercher..." />
                    <input id="history-date-from" type="date" class="input" />
                    <input id="history-date-to" type="date" class="input" />
                    <button class="btn secondary" id="btn-filter-history">Filtrer</button>
                </div>

                <table aria-label="Historique complet">
                    <thead>
                        <tr>
                            <th>Date/Heure</th>
                            <th>Type</th>
                            <th>Détails</th>
                            <th>Utilisateur</th>
                            <th>Remarques</th>
                        </tr>
                    </thead>
                    <tbody id="historyTable"></tbody>
                </table>
            </section>
        </main>
    </div>

    <!-- MODALS -->
    <!-- Modal: Nouveau Produit -->
    <div class="modal" id="modalNewProduct">
        <div class="modal-box">
            <div class="modal-header">
                <h3>Ajouter un Produit</h3>
                <button class="modal-close" data-close="modalNewProduct">&times;</button>
            </div>
            <form id="formNewProduct">
                <div class="form-row full">
                    <div class="form-label">Réf / Code-barre</div>
                    <input name="reference"  id="np-code" class="input" placeholder="Code-barre ou référence unique" required/>
                </div>

                <div class="form-row">
                    <div>
                        <div class="form-label">Désignation</div>
                        <input name="nom_produit" id="np-name" class="input" placeholder="Nom produit" required/>
                    </div>
                    <div>
                        <div class="form-label">Catégorie</div>
                        <select id="np-category" class="input" name="categorie">
                            <option value="">-- Sélectionner --</option>
                            <option value="Alimentaire">Alimentaire</option>
                            <option value="Boisson">Boisson</option>
                            <option value="Hygiène">Hygiène</option>
                            <option value="Autre">Autre</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div>
                        <div class="form-label">Prix Achat</div>
                        <input name="Prix_Achat" id="np-buy" class="input" type="number" placeholder="0.00" step="0.01" required/>
                    </div>
                    <div>
                        <div class="form-label">Prix Vente</div>
                        <input name="Prix_Vente" id="np-sale" class="input" type="number" placeholder="0.00" step="0.01" required/>
                    </div>
                </div>

                <div class="form-row">
                    <div>
                        <div class="form-label">Seuil Alerte</div>
                        <input id="np-alert" name="Seuil_Alerte" class="input" type="number" placeholder="Quantité mini" step="1" value="5" />
                    </div>
                    <div>
                        <div class="form-label">Stock Initial</div>
                        <input id="np-initial" name="Stock_Initial" class="input" type="number" placeholder="0" step="1" />
                    </div>
                </div>

                <div style="display:flex;gap:8px;margin-top:16px">
                    <button class="btn" id="np-save">Enregistrer</button>
                    <button class="btn secondary" data-close="modalNewProduct">Annuler</button>
                </div>
                </form>
        </div>
    </div>

    <!-- Modal: Entrée Stock -->
    <div class="modal" id="modalAddStock">
        <div class="modal-box">
            <div class="modal-header">
                <h3><i class="fas fa-arrow-up"></i> Entrée de Stock</h3>
                <button class="modal-close" data-close="modalAddStock">&times;</button>
            </div>

            <form id="formAddStock"  action="assets/Api/addStockEntree.php" method="post">
                <!-- Sélection du produit -->
                <div class="form-row full">
                    <div class="form-label">Produit <span class="required">*</span></div>
                    <select id="id_produit"  class="input" name="id_produit" required>
                        <option value="">-- Sélectionner un produit --</option>
                    </select>
                </div>

                <!-- Ligne 2: Dépôt et Quantité -->
                <div class="form-row">

                    <div>
                        <div class="form-label">Quantité <span class="required">*</span></div>
                        <input id="as-qty" name="quantite" class="input" type="number" placeholder="0" step="1" min="1" required />
                    </div>
                </div>

                <!-- Ligne 3: Date et Référence -->
                <div class="form-row">
                    <div>
                        <div class="form-label">Date d'entrée <span class="required">*</span></div>
                        <input id="as-date" name="date_entre" class="input" type="date" required />
                    </div>
                    <div>
                        <div class="form-label">Numéro de Bon <span class="required">*</span></div>
                        <input id="as-ref" name="numero_reference" class="input" placeholder="Bon de commande, facture..." required />
                    </div>
                </div>

                <!-- Ligne 4: Notes -->
                <div class="form-row full">
                    <div class="form-label">Notes / Observations</div>
                    <textarea id="as-notes" name="notes" class="input" placeholder="Remarques, problèmes détectés, conditions..." style="min-height:80px;resize:vertical"></textarea>
                </div>

                <!-- Ligne 5: Informations du produit (affichage) -->
                <div id="as-product-info" style="display:none;background:#f5f5f5;border-radius:6px;padding:12px;margin:12px 0;">
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;font-size:14px;">
                        <div>
                            <span style="color:#666">Prix Achat:</span>
                            <div style="font-weight:600;font-size:16px;color:var(--accent)" id="as-buy-price">0.00 fc</div>
                        </div>
                        <div>
                            <span style="color:#666">Stock Actuel:</span>
                            <div style="font-weight:600;font-size:16px;color:var(--accent-2)" id="as-current-stock">0</div>
                        </div>
                    </div>
                </div>

                <!-- Boutons d'action -->
                <div style="display:flex;gap:8px;margin-top:20px;justify-content:flex-end">
                    <button type="reset" class="btn secondary">
                        <i class="fas fa-redo"></i> Réinitialiser
                    </button>
                    <button type="button" class="btn secondary" data-close="modalAddStock">
                        <i class="fas fa-times"></i> Annuler
                    </button>
                    <button type="submit" class="btn success">
                        <i class="fas fa-check"></i> Enregistrer Entrée
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Approvisionnement Magasin -->
    <div class="modal" id="modalApproMagasin">
        <div class="modal-box">
            <div class="modal-header">
                <h3><i class="fas fa-truck"></i> Approvisionner Magasin 1</h3>
                <button class="modal-close" data-close="modalApproMagasin">&times;</button>
            </div>

            <form id="formApproMagasin" action="assets/Api/approMagasin.php" method="post">
                <!-- Sélection du produit -->
                <div class="form-row full">
                    <div class="form-label">Produit <span class="required">*</span></div>
                    <select id="am-product" name="id_produit" class="input" required>
                        <option value="">-- Sélectionner un produit --</option>
                    </select>
                </div>

                <!-- Quantité -->
                <div class="form-row">
                    <div>
                        <div class="form-label">Quantité à transférer <span class="required">*</span></div>
                        <input id="am-qty" name="quantite" class="input" type="number" placeholder="0" step="1" min="1" required />
                    </div>
                </div>

                <!-- Informations du produit -->
                <div id="am-product-info" style="display:none;background:#f5f5f5;border-radius:6px;padding:12px;margin:12px 0;">
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;font-size:14px;">
                        <div>
                            <span style="color:#666">Stock Principal Disponible:</span>
                            <div style="font-weight:600;font-size:16px;color:var(--accent-2)" id="am-stock-principal">0</div>
                        </div>
                        <div>
                            <span style="color:#666">Stock Actuel Magasin:</span>
                            <div style="font-weight:600;font-size:16px;color:var(--accent)" id="am-stock-magasin">0</div>
                        </div>
                    </div>
                </div>

                <!-- Notes -->
                <div class="form-row full">
                    <div class="form-label">Notes / Observations</div>
                    <textarea id="am-notes" name="notes" class="input" placeholder="Remarques..." style="min-height:60px;resize:vertical"></textarea>
                </div>

                <!-- Boutons d'action -->
                <div style="display:flex;gap:8px;margin-top:20px;justify-content:flex-end">
                    <button type="reset" class="btn secondary">
                        <i class="fas fa-redo"></i> Réinitialiser
                    </button>
                    <button type="button" class="btn secondary" data-close="modalApproMagasin">
                        <i class="fas fa-times"></i> Annuler
                    </button>
                    <button type="submit" class="btn success">
                        <i class="fas fa-check"></i> Approvisionner
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Nouveau Mouvement -->
    <div class="modal" id="modalNewMovement">
        <div class="modal-box">
            <div class="modal-header">
                <h3><i class="fas fa-exchange-alt"></i> Nouveau Mouvement de Stock</h3>
                <button class="modal-close" data-close="modalNewMovement">&times;</button>
            </div>

            <form id="formNewMovement" action="assets/Api/addMovement.php" method="post">
                <!-- Type de mouvement -->
                <div class="form-row full">
                    <div class="form-label">Type de Mouvement <span class="required">*</span></div>
                    <select id="nm-type" name="type_mouvement" class="input" required>
                        <option value="">-- Sélectionner --</option>
                        <option value="entree">Entrée de stock</option>
                        <option value="sortie">Sortie de stock</option>
                        <option value="transfert">Transfert entre dépôts</option>
                        <option value="ajustement">Ajustement d'inventaire</option>
                        <option value="retour">Retour fournisseur</option>
                        <option value="perte">Perte / Casse</option>
                    </select>
                </div>

                <!-- Sélection du produit -->
                <div class="form-row full">
                    <div class="form-label">Produit <span class="required">*</span></div>
                    <select id="nm-product" name="id_produit" class="input" required>
                        <option value="">-- Sélectionner un produit --</option>
                    </select>
                </div>

                <!-- Quantité et Date -->
                <div class="form-row">
                    <div>
                        <div class="form-label">Quantité <span class="required">*</span></div>
                        <input id="nm-qty" name="quantite" class="input" type="number" placeholder="0" step="1" min="1" required />
                    </div>
                    <div>
                        <div class="form-label">Date du mouvement <span class="required">*</span></div>
                        <input id="nm-date" name="date_mouvement" class="input" type="date" required />
                    </div>
                </div>

                <!-- Référence -->
                <div class="form-row full">
                    <div class="form-label">Référence du mouvement</div>
                    <input id="nm-ref" name="reference_mouvement" class="input" placeholder="N° bon, facture, BL..." />
                </div>

                <!-- Notes -->
                <div class="form-row full">
                    <div class="form-label">Notes / Observations</div>
                    <textarea id="nm-notes" name="notes" class="input" placeholder="Raison du mouvement, remarques..." style="min-height:80px;resize:vertical"></textarea>
                </div>

                <!-- Informations du produit -->
                <div id="nm-product-info" style="display:none;background:#f5f5f5;border-radius:6px;padding:12px;margin:12px 0;">
                    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;font-size:14px;">
                        <div>
                            <span style="color:#666">Stock Actuel:</span>
                            <div style="font-weight:600;font-size:16px;color:var(--accent-2)" id="nm-current-stock">0</div>
                        </div>
                        <div>
                            <span style="color:#666">Après Mouvement:</span>
                            <div style="font-weight:600;font-size:16px;color:var(--accent)" id="nm-new-stock">0</div>
                        </div>
                        <div>
                            <span style="color:#666">Seuil d'Alerte:</span>
                            <div style="font-weight:600;font-size:16px" id="nm-alert-threshold">0</div>
                        </div>
                    </div>
                </div>

                <!-- Boutons d'action -->
                <div style="display:flex;gap:8px;margin-top:20px;justify-content:flex-end">
                    <button type="reset" class="btn secondary">
                        <i class="fas fa-redo"></i> Réinitialiser
                    </button>
                    <button type="button" class="btn secondary" data-close="modalNewMovement">
                        <i class="fas fa-times"></i> Annuler
                    </button>
                    <button type="submit" class="btn success">
                        <i class="fas fa-check"></i> Enregistrer Mouvement
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="assets/js/script_stock.js"></script>

    </script>
</body>

</html>